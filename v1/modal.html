<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<title>Modal - Enhanced</title>
<link rel='stylesheet' href='/shared/styles.css'>
<style>
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
.modal.show { display: flex; }
.modal-content { background-color: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%; position: relative; animation: slideDown 0.3s ease-out; }
@keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
.modal-header h3 { margin: 0; }
.close-btn { font-size: 28px; font-weight: bold; cursor: pointer; background: none; border: none; color: #666; }
.close-btn:hover { color: #000; }
.modal-body { margin: 20px 0; }
.modal-footer { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; border-top: 2px solid #ddd; padding-top: 15px; }
.btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
.form-group { margin: 15px 0; }
.form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
.form-group input, .form-group textarea, .form-group select { padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
.modal-sm .modal-content { max-width: 300px; }
.modal-lg .modal-content { max-width: 700px; }
.modal-fullscreen .modal-content { max-width: 95%; max-height: 95%; overflow-y: auto; }
</style>
</head>
<body>
<a href='/index.html' class='small btn'>Back</a>

<section class='card'>
<h2>Enhanced Modal Dialogs</h2>
<p style='color: #666; margin-bottom: 20px;'>Multiple modal types with different interactions and sizes</p>

<div class='btn-grid'>
  <button class='btn' onclick='openBasicModal()' data-testid='btn-basic-modal'>Basic Modal</button>
  <button class='btn' onclick='openFormModal()' data-testid='btn-form-modal'>Form Modal</button>
  <button class='btn' onclick='openConfirmModal()' data-testid='btn-confirm-modal'>Confirm Dialog</button>
  <button class='btn' onclick='openSmallModal()' data-testid='btn-small-modal'>Small Modal</button>
  <button class='btn' onclick='openLargeModal()' data-testid='btn-large-modal'>Large Modal</button>
  <button class='btn' onclick='openFullscreenModal()' data-testid='btn-fullscreen-modal'>Fullscreen Modal</button>
  <button class='btn' onclick='openNestedModal()' data-testid='btn-nested-modal'>Nested Modal</button>
  <button class='btn' onclick='openAutoCloseModal()' data-testid='btn-autoclose-modal'>Auto-Close Modal</button>
</div>

<div id='result' style='margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 4px; display: none;' data-testid='result-message'></div>

</section>

<!-- Modal Container -->
<div id='modalContainer'></div>

<script src='/shared/scripts.js'></script>
<script>
let modalCount = 0;

function createModal(options) {
  const {
    title = 'Modal',
    content = '',
    size = '',
    showFooter = true,
    buttons = [],
    onClose = null,
    autoClose = 0
  } = options;

  modalCount++;
  const modalId = `modal-${modalCount}`;

  const modal = document.createElement('div');
  modal.className = `modal ${size}`;
  modal.id = modalId;
  modal.dataset.testid = modalId;

  const buttonsHTML = buttons.map((btn, index) => 
    `<button class='btn' onclick='${btn.onClick}' data-testid='${btn.testId || `btn-${index}`}'>${btn.text}</button>`
  ).join('');

  modal.innerHTML = `
    <div class='modal-content'>
      <div class='modal-header'>
        <h3>${title}</h3>
        <button class='close-btn' onclick='closeModal("${modalId}")' data-testid='btn-close-${modalId}'>&times;</button>
      </div>
      <div class='modal-body' data-testid='modal-body-${modalId}'>
        ${content}
      </div>
      ${showFooter ? `
        <div class='modal-footer'>
          ${buttonsHTML}
          ${buttons.length === 0 ? `<button class='btn' onclick='closeModal("${modalId}")' data-testid='btn-ok-${modalId}'>OK</button>` : ''}
        </div>
      ` : ''}
    </div>
  `;

  document.getElementById('modalContainer').appendChild(modal);
  
  // Show modal with animation
  setTimeout(() => modal.classList.add('show'), 10);

  // Close on background click
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeModal(modalId);
    }
  });

  // Auto-close if specified
  if (autoClose > 0) {
    setTimeout(() => closeModal(modalId), autoClose);
  }

  // Store onClose callback
  if (onClose) {
    modal.dataset.onClose = onClose.toString();
  }

  return modalId;
}

function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.remove('show');
    setTimeout(() => modal.remove(), 300);
    
    // Call onClose callback if exists
    if (modal.dataset.onClose) {
      try {
        eval(modal.dataset.onClose)();
      } catch (e) {}
    }
  }
}

function showResult(message) {
  const result = document.getElementById('result');
  result.textContent = message;
  result.style.display = 'block';
  setTimeout(() => result.style.display = 'none', 3000);
}

// Modal Types

function openBasicModal() {
  createModal({
    title: 'Basic Modal',
    content: `
      <p>This is a basic modal dialog with simple content.</p>
      <p>You can close it by clicking the X button, the OK button, or clicking outside the modal.</p>
    `
  });
}

function openFormModal() {
  const modalId = createModal({
    title: 'User Registration Form',
    size: 'modal-lg',
    content: `
      <form id='registrationForm' onsubmit='return false;'>
        <div class='form-group'>
          <label>Full Name *</label>
          <input type='text' id='fullName' data-testid='input-fullname' required>
        </div>
        <div class='form-group'>
          <label>Email *</label>
          <input type='email' id='email' data-testid='input-email' required>
        </div>
        <div class='form-group'>
          <label>Phone</label>
          <input type='tel' id='phone' data-testid='input-phone'>
        </div>
        <div class='form-group'>
          <label>Country</label>
          <select id='country' data-testid='select-country'>
            <option value=''>Select Country</option>
            <option value='USA'>USA</option>
            <option value='UK'>UK</option>
            <option value='Canada'>Canada</option>
            <option value='India'>India</option>
          </select>
        </div>
        <div class='form-group'>
          <label>Comments</label>
          <textarea id='comments' rows='3' data-testid='textarea-comments'></textarea>
        </div>
      </form>
    `,
    buttons: [
      { text: 'Cancel', onClick: `closeModal('${modalId}')`, testId: 'btn-cancel-form' },
      { text: 'Submit', onClick: 'submitForm()', testId: 'btn-submit-form' }
    ]
  });
}

function submitForm() {
  const name = document.getElementById('fullName').value;
  const email = document.getElementById('email').value;
  
  if (!name || !email) {
    alert('Please fill in required fields');
    return;
  }
  
  showResult(`Form submitted successfully! Name: ${name}, Email: ${email}`);
  closeModal(document.querySelector('.modal.show').id);
}

function openConfirmModal() {
  const modalId = createModal({
    title: 'Confirm Action',
    content: `
      <p style='font-size: 16px;'>Are you sure you want to delete this item?</p>
      <p style='color: #f44336;'>This action cannot be undone.</p>
    `,
    buttons: [
      { text: 'Cancel', onClick: `closeModal('${modalId}')`, testId: 'btn-cancel-confirm' },
      { text: 'Delete', onClick: 'confirmDelete()', testId: 'btn-confirm-delete' }
    ]
  });
}

function confirmDelete() {
  showResult('Item deleted successfully!');
  closeModal(document.querySelector('.modal.show').id);
}

function openSmallModal() {
  createModal({
    title: 'Small Modal',
    size: 'modal-sm',
    content: `
      <p>This is a small modal dialog.</p>
      <p>Perfect for quick messages!</p>
    `
  });
}

function openLargeModal() {
  createModal({
    title: 'Large Modal',
    size: 'modal-lg',
    content: `
      <h4>Large Modal Content</h4>
      <p>This modal has more space for detailed content.</p>
      <ul>
        <li>Feature 1: Enhanced user experience</li>
        <li>Feature 2: Better content organization</li>
        <li>Feature 3: Improved readability</li>
        <li>Feature 4: More interactive elements</li>
      </ul>
      <p>You can include tables, images, or any other HTML content here.</p>
    `
  });
}

function openFullscreenModal() {
  createModal({
    title: 'Fullscreen Modal',
    size: 'modal-fullscreen',
    content: `
      <h4>Fullscreen Modal</h4>
      <p>This modal takes up most of the screen space.</p>
      <p>Perfect for displaying large amounts of content or complex forms.</p>
      <div style='margin: 20px 0; padding: 20px; background: #f5f5f5; border-radius: 4px;'>
        <h5>Section 1</h5>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
      </div>
      <div style='margin: 20px 0; padding: 20px; background: #f5f5f5; border-radius: 4px;'>
        <h5>Section 2</h5>
        <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
      </div>
      <div style='margin: 20px 0; padding: 20px; background: #f5f5f5; border-radius: 4px;'>
        <h5>Section 3</h5>
        <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
      </div>
    `
  });
}

function openNestedModal() {
  const parentId = createModal({
    title: 'Parent Modal',
    content: `
      <p>This is the parent modal.</p>
      <p>Click the button below to open a nested modal.</p>
      <button class='btn' onclick='openChildModal()' data-testid='btn-open-child' style='margin-top: 15px;'>Open Child Modal</button>
    `
  });
}

function openChildModal() {
  createModal({
    title: 'Child Modal',
    size: 'modal-sm',
    content: `
      <p>This is a nested modal!</p>
      <p>You can have multiple modals open at once.</p>
    `
  });
}

function openAutoCloseModal() {
  createModal({
    title: 'Auto-Close Modal',
    content: `
      <p>This modal will automatically close in 3 seconds.</p>
      <p style='color: #ff9800; font-weight: bold;'>Countdown: 3...</p>
    `,
    autoClose: 3000,
    showFooter: false
  });
}
</script>
</body>
</html>
