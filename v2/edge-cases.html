<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<title>LCNC Edge Cases - Comprehensive Test Suite</title>
<link rel='stylesheet' href='../shared/styles.css'>
<style>
.test-section { margin: 30px 0; padding: 20px; border: 2px solid #ddd; border-radius: 8px; }
.test-section h3 { margin-top: 0; color: #2196F3; }
.test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
.test-card { padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; }
.test-card h4 { margin-top: 0; font-size: 16px; }
.lazy-container { height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: white; }
.lazy-item { padding: 15px; margin: 10px 0; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; }
.skeleton { height: 60px; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; margin: 10px 0; border-radius: 4px; }
@keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
.iframe-container { border: 2px solid #4CAF50; padding: 10px; margin: 10px 0; }
.nested-iframe { border: 2px solid #FF9800; padding: 10px; margin: 10px 0; }
.dynamic-content { min-height: 100px; padding: 15px; background: #e3f2fd; border: 1px solid #2196F3; border-radius: 4px; }
.popup-trigger { margin: 10px 5px; }
.notification-box { position: fixed; top: 20px; right: 20px; padding: 15px 20px; background: #4CAF50; color: white; border-radius: 4px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 10000; display: none; }
.notification-box.show { display: block; animation: slideIn 0.3s; }
@keyframes slideIn { from { transform: translateX(400px); } to { transform: translateX(0); } }
.text-validation-box { padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
.resolution-display { padding: 10px; background: #e8f5e9; border: 1px solid #4CAF50; border-radius: 4px; font-weight: bold; }
.download-link { display: inline-block; margin: 10px 5px; padding: 10px 15px; background: #2196F3; color: white; text-decoration: none; border-radius: 4px; }
.download-link:hover { background: #1976D2; }
.file-upload-area { border: 2px dashed #ddd; padding: 30px; text-align: center; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
.file-upload-area:hover { border-color: #2196F3; background: #f5f5f5; }
.file-upload-area.dragover { border-color: #4CAF50; background: #e8f5e9; }
.uploaded-files { margin-top: 15px; }
.uploaded-file { padding: 10px; margin: 5px 0; background: #e3f2fd; border: 1px solid #2196F3; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
.char-display { display: inline-block; padding: 5px 10px; margin: 5px; background: #fff; border: 1px solid #ddd; border-radius: 4px; }
</style>
</head>
<body>
<a href='/index.html' class='small btn'>Back</a>

<section class='card'>
<h2>LCNC Edge Cases - Comprehensive Test Suite</h2>
<p style='color: #666; margin-bottom: 30px;'>Based on Q2 2024 ticket analysis - Testing critical edge cases that caused production issues</p>

<!-- Notification Box -->
<div id='notification' class='notification-box' data-testid='notification-box'></div>

<!-- Section 1: Browser Popups & Notifications -->
<div class='test-section'>
  <h3>1. Browser Popups & Notifications (Tickets: LCNC-10074, 11020, 11090)</h3>
  <p><strong>Issue:</strong> Browser native popups interfering with tests - Save Card, Location, Camera, Notifications</p>
  
  <div class='test-grid'>
    <div class='test-card'>
      <h4>Simulated Browser Notifications</h4>
      <button class='btn popup-trigger' onclick='showNotification("Success", "Operation completed successfully!")' data-testid='show-success-notification'>Show Success Notification</button>
      <button class='btn popup-trigger' onclick='showNotification("Warning", "Please review your input")' data-testid='show-warning-notification'>Show Warning</button>
      <button class='btn popup-trigger' onclick='showNotification("Error", "Something went wrong!")' data-testid='show-error-notification'>Show Error</button>
    </div>
    
    <div class='test-card'>
      <h4>Confirm Dialog Simulation</h4>
      <button class='btn' onclick='triggerConfirmDialog()' data-testid='trigger-confirm'>Trigger Confirm Dialog</button>
      <div id='confirm-result' style='margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px; display: none;' data-testid='confirm-result'></div>
    </div>
    
    <div class='test-card'>
      <h4>Alert Dialog Simulation</h4>
      <button class='btn' onclick='triggerAlertDialog()' data-testid='trigger-alert'>Trigger Alert</button>
      <div id='alert-result' style='margin-top: 10px;' data-testid='alert-result'></div>
    </div>
    
    <div class='test-card'>
      <h4>Prompt Dialog Simulation</h4>
      <button class='btn' onclick='triggerPromptDialog()' data-testid='trigger-prompt'>Trigger Prompt</button>
      <div id='prompt-result' style='margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px; display: none;' data-testid='prompt-result'></div>
    </div>
  </div>
</div>

<!-- Section 2: File Download/Upload Edge Cases -->
<div class='test-section'>
  <h3>2. File Download/Upload Edge Cases (Tickets: LCNC-10233, 9868, 9840)</h3>
  <p><strong>Issue:</strong> Download in new tab, incomplete downloads (.crdownload), dynamic filenames, validation failures</p>
  
  <div class='test-grid'>
    <div class='test-card'>
      <h4>File Downloads</h4>
      <a href='#' class='download-link' onclick='downloadFile("sample.txt", "text/plain", "This is a sample text file for testing."); return false;' data-testid='download-txt'>Download TXT</a>
      <a href='#' class='download-link' onclick='downloadFile("data.csv", "text/csv", "Name,Email,Age\nJohn,john@example.com,30\nJane,jane@example.com,25"); return false;' data-testid='download-csv'>Download CSV</a>
      <a href='#' class='download-link' onclick='downloadFile("report.json", "application/json", JSON.stringify({status: "success", data: [1,2,3]}, null, 2)); return false;' data-testid='download-json'>Download JSON</a>
      <button class='btn' onclick='downloadInNewTab()' data-testid='download-new-tab'>Download in New Tab</button>
      <button class='btn' onclick='downloadWithDynamicName()' data-testid='download-dynamic-name'>Download Dynamic Filename</button>
    </div>
    
    <div class='test-card'>
      <h4>File Upload with Drag & Drop</h4>
      <div class='file-upload-area' id='dropZone' data-testid='file-drop-zone'>
        <p>üìÅ Drag & Drop files here or click to browse</p>
        <input type='file' id='fileInput' multiple style='display: none;' data-testid='file-input'>
      </div>
      <div class='uploaded-files' id='uploadedFiles' data-testid='uploaded-files'></div>
    </div>
    
    <div class='test-card'>
      <h4>File Type Validation</h4>
      <input type='file' accept='.pdf,.doc,.docx' onchange='validateFileType(this)' data-testid='file-type-input'>
      <div id='file-validation-result' style='margin-top: 10px;' data-testid='file-validation-result'></div>
    </div>
  </div>
</div>

<!-- Section 3: Iframe & Nested Iframe Scenarios -->
<div class='test-section'>
  <h3>3. Iframe & Nested Iframe Scenarios (Tickets: LCNC-10456, 9886)</h3>
  <p><strong>Issue:</strong> Element detection in iframes, 40+ iframes causing performance issues</p>
  
  <div class='iframe-container'>
    <h4>Level 1 Iframe</h4>
    <iframe id='iframe1' style='width: 100%; height: 300px; border: 1px solid #ddd;' data-testid='iframe-level-1'></iframe>
  </div>
  
  <div class='test-card'>
    <h4>Multiple Iframes</h4>
    <button class='btn' onclick='createMultipleIframes(5)' data-testid='create-5-iframes'>Create 5 Iframes</button>
    <button class='btn' onclick='createMultipleIframes(10)' data-testid='create-10-iframes'>Create 10 Iframes</button>
    <button class='btn' onclick='clearIframes()' data-testid='clear-iframes'>Clear All</button>
    <div id='iframe-container' style='margin-top: 15px;' data-testid='multiple-iframe-container'></div>
  </div>
</div>

<!-- Section 4: Lazy Loading & Infinite Scroll -->
<div class='test-section'>
  <h3>4. Lazy Loading & Infinite Scroll (Ticket: LCNC-9889)</h3>
  <p><strong>Issue:</strong> Scroll behavior, lazy loading causing flaky tests, elements not in viewport</p>
  
  <div class='test-card'>
    <h4>Infinite Scroll with Lazy Loading</h4>
    <div class='lazy-container' id='lazyContainer' data-testid='lazy-scroll-container'>
      <p style='text-align: center; color: #999;'>Scroll down to load more items...</p>
    </div>
    <div style='margin-top: 10px; text-align: center;'>
      <span>Items Loaded: <strong id='itemCount' data-testid='item-count'>0</strong></span>
      <button class='btn' onclick='resetLazyLoad()' style='margin-left: 15px;' data-testid='reset-lazy-load'>Reset</button>
    </div>
  </div>
</div>

<!-- Section 5: Dynamic Content & DOM Changes -->
<div class='test-section'>
  <h3>5. Dynamic Content & DOM Changes</h3>
  <p><strong>Issue:</strong> Elements appearing/disappearing, attribute changes, content updates</p>
  
  <div class='test-grid'>
    <div class='test-card'>
      <h4>Dynamic Element Visibility</h4>
      <button class='btn' onclick='toggleDynamicElement()' data-testid='toggle-element'>Toggle Element</button>
      <div id='dynamicElement' class='dynamic-content' style='display: none; margin-top: 10px;' data-testid='dynamic-element'>
        <p>This element appears and disappears dynamically!</p>
        <input type='text' placeholder='Dynamic input field' data-testid='dynamic-input'>
      </div>
    </div>
    
    <div class='test-card'>
      <h4>Delayed Content Loading</h4>
      <button class='btn' onclick='loadDelayedContent(2000)' data-testid='load-2s-delay'>Load (2s delay)</button>
      <button class='btn' onclick='loadDelayedContent(5000)' data-testid='load-5s-delay'>Load (5s delay)</button>
      <div id='delayedContent' style='margin-top: 10px;' data-testid='delayed-content'></div>
    </div>
    
    <div class='test-card'>
      <h4>Attribute Changes</h4>
      <button class='btn' id='attributeBtn' onclick='changeAttributes()' data-testid='change-attributes-btn'>Change My Attributes</button>
      <div id='attributeDisplay' style='margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px;' data-testid='attribute-display'></div>
    </div>
  </div>
</div>

<!-- Section 6: Text Validation Edge Cases -->
<div class='test-section'>
  <h3>6. Text Validation Edge Cases (Ticket: LCNC-9577)</h3>
  <p><strong>Issue:</strong> Invisible characters (\\u0020 vs \\u00A0), encoding issues, whitespace differences</p>
  
  <div class='test-grid'>
    <div class='test-card'>
      <h4>Invisible Character Test</h4>
      <div class='text-validation-box' data-testid='invisible-char-text'>
Regular space: "Hello World"
Non-breaking space: "Hello World"
Mixed spaces: "Hello   World"
      </div>
      <button class='btn' onclick='analyzeInvisibleChars()' data-testid='analyze-chars'>Analyze Characters</button>
      <div id='charAnalysis' style='margin-top: 10px;' data-testid='char-analysis'></div>
    </div>
    
    <div class='test-card'>
      <h4>Special Characters & Encoding</h4>
      <textarea id='specialCharsInput' rows='4' style='width: 100%; padding: 8px;' placeholder='Enter text with special characters...' data-testid='special-chars-input'>Test‚Ñ¢ ¬© ¬Æ ‚Ç¨ ¬£ ¬• ¬ß ¬∂ ‚Ä† ‚Ä° ‚Ä¢ ‚Ä∞ ‚Ä≤ ‚Ä≥</textarea>
      <button class='btn' onclick='validateSpecialChars()' data-testid='validate-special-chars'>Validate Encoding</button>
      <div id='encodingResult' style='margin-top: 10px;' data-testid='encoding-result'></div>
    </div>
    
    <div class='test-card'>
      <h4>Whitespace Variations</h4>
      <div style='margin: 10px 0;'>
        <div class='char-display' data-testid='space-normal'>Normal: "A B"</div>
        <div class='char-display' data-testid='space-nbsp'>NBSP: "A B"</div>
        <div class='char-display' data-testid='space-tab'>Tab: "A	B"</div>
        <div class='char-display' data-testid='space-newline'>Newline: "A
B"</div>
      </div>
      <button class='btn' onclick='compareWhitespace()' data-testid='compare-whitespace'>Compare All</button>
      <div id='whitespaceResult' style='margin-top: 10px;' data-testid='whitespace-result'></div>
    </div>
  </div>
</div>

<!-- Section 7: Browser Resolution Changes -->
<div class='test-section'>
  <h3>7. Browser Resolution & Viewport Changes (Tickets: LCNC-10141, 10490)</h3>
  <p><strong>Issue:</strong> iPad resolution changes, multiple tabs, responsive design testing</p>
  
  <div class='test-card'>
    <h4>Current Viewport Information</h4>
    <div class='resolution-display' id='resolutionDisplay' data-testid='resolution-display'>
      Loading resolution info...
    </div>
    <div style='margin-top: 15px;'>
      <button class='btn' onclick='updateResolutionInfo()' data-testid='update-resolution'>Refresh Info</button>
      <button class='btn' onclick='simulateResize("mobile")' data-testid='simulate-mobile'>Simulate Mobile</button>
      <button class='btn' onclick='simulateResize("tablet")' data-testid='simulate-tablet'>Simulate Tablet</button>
      <button class='btn' onclick='simulateResize("desktop")' data-testid='simulate-desktop'>Simulate Desktop</button>
    </div>
    <div id='responsiveContent' style='margin-top: 15px; padding: 15px; background: #f5f5f5; border-radius: 4px;' data-testid='responsive-content'>
      <p>Responsive content adapts based on viewport size</p>
    </div>
  </div>
</div>

<!-- Section 8: Shadow DOM & Custom Elements -->
<div class='test-section'>
  <h3>8. Shadow DOM & Custom Elements (Tickets: LCNC-10797)</h3>
  <p><strong>Issue:</strong> Element detection in Shadow DOM, custom web components, Lightning components</p>
  
  <div class='test-card'>
    <h4>Shadow DOM Elements</h4>
    <div id='shadowHost' data-testid='shadow-host'></div>
    <button class='btn' onclick='createShadowDOM()' data-testid='create-shadow-dom'>Create Shadow DOM</button>
    <button class='btn' onclick='createNestedShadowDOM()' data-testid='create-nested-shadow'>Create Nested Shadow DOM</button>
    <div id='shadowResult' style='margin-top: 15px;' data-testid='shadow-result'></div>
  </div>
</div>

<!-- Section 9: Hover & Mouse Events -->
<div class='test-section'>
  <h3>9. Hover & Mouse Events (Ticket: LCNC-11091)</h3>
  <p><strong>Issue:</strong> Hover events not triggering properly on Firefox 135+, dropdown issues</p>
  
  <div class='test-grid'>
    <div class='test-card'>
      <h4>Hover-triggered Dropdown</h4>
      <div style='position: relative;'>
        <button class='btn' id='hoverBtn' data-testid='hover-trigger'>Hover Over Me</button>
        <div id='hoverDropdown' style='display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ddd; padding: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 100; min-width: 200px;' data-testid='hover-dropdown'>
          <p><strong>Dropdown Content</strong></p>
          <button class='small btn' data-testid='dropdown-option-1'>Option 1</button>
          <button class='small btn' data-testid='dropdown-option-2'>Option 2</button>
          <button class='small btn' data-testid='dropdown-option-3'>Option 3</button>
        </div>
      </div>
    </div>
    
    <div class='test-card'>
      <h4>Mouse Event Tracking</h4>
      <div id='mouseTracker' style='padding: 30px; background: #f5f5f5; border: 2px solid #ddd; border-radius: 4px; text-align: center;' data-testid='mouse-tracker'>
        <p>Move mouse here to track events</p>
      </div>
      <div id='mouseEvents' style='margin-top: 10px; font-family: monospace; font-size: 12px;' data-testid='mouse-events'></div>
    </div>
  </div>
</div>

<!-- Section 10: Form Submission Edge Cases -->
<div class='test-section'>
  <h3>10. Form Submission & Validation Edge Cases</h3>
  <p><strong>Issue:</strong> Form validation, submission failures, data persistence</p>
  
  <div class='test-card'>
    <h4>Complex Form with Edge Cases</h4>
    <form id='edgeCaseForm' onsubmit='handleFormSubmit(event)' data-testid='edge-case-form'>
      <div class='form-group'>
        <label>Email with validation</label>
        <input type='email' name='email' required pattern='[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$' data-testid='form-email'>
      </div>
      <div class='form-group'>
        <label>Phone (format: XXX-XXX-XXXX)</label>
        <input type='tel' name='phone' pattern='[0-9]{3}-[0-9]{3}-[0-9]{4}' data-testid='form-phone'>
      </div>
      <div class='form-group'>
        <label>URL</label>
        <input type='url' name='website' data-testid='form-url'>
      </div>
      <div class='form-group'>
        <label>Number (1-100)</label>
        <input type='number' name='age' min='1' max='100' data-testid='form-number'>
      </div>
      <div class='form-group'>
        <label>
          <input type='checkbox' name='terms' required data-testid='form-terms'>
          I agree to terms (required)
        </label>
      </div>
      <button type='submit' class='btn' data-testid='form-submit'>Submit Form</button>
      <button type='reset' class='btn' data-testid='form-reset'>Reset</button>
    </form>
    <div id='formResult' style='margin-top: 15px; display: none;' data-testid='form-result'></div>
  </div>
</div>

</section>

<script src='../shared/scripts.js'></script>
<script>
onReady(() => {
  // Initialize resolution display
  updateResolutionInfo();
  
  // Initialize lazy loading
  initLazyLoad();
  
  // Initialize iframe content
  initIframe();
  
  // Initialize file upload
  initFileUpload();
  
  // Update resolution on window resize
  window.addEventListener('resize', updateResolutionInfo);
});

// Notification System
function showNotification(title, message) {
  const notification = document.getElementById('notification');
  notification.innerHTML = `<strong>${title}:</strong> ${message}`;
  notification.className = 'notification-box show';
  setTimeout(() => {
    notification.className = 'notification-box';
  }, 3000);
}

// Dialog Simulations
function triggerConfirmDialog() {
  const result = confirm('Do you want to proceed with this action?');
  const resultDiv = document.getElementById('confirm-result');
  resultDiv.style.display = 'block';
  resultDiv.innerHTML = `User selected: <strong>${result ? 'OK' : 'Cancel'}</strong>`;
  resultDiv.style.background = result ? '#d4edda' : '#f8d7da';
}

function triggerAlertDialog() {
  alert('This is an alert dialog for testing!');
  document.getElementById('alert-result').innerHTML = '<p style="color: green;">‚úì Alert was triggered</p>';
}

function triggerPromptDialog() {
  const input = prompt('Please enter your name:');
  const resultDiv = document.getElementById('prompt-result');
  resultDiv.style.display = 'block';
  if (input !== null) {
    resultDiv.innerHTML = `User entered: <strong>${input || '(empty)'}</strong>`;
    resultDiv.style.background = '#d4edda';
  } else {
    resultDiv.innerHTML = 'User cancelled the prompt';
    resultDiv.style.background = '#f8d7da';
  }
}

// File Download Functions
function downloadFile(filename, mimeType, content) {
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  showNotification('Download', `${filename} download started`);
}

function downloadInNewTab() {
  const content = 'This file was downloaded in a new tab - testing LCNC-10233 edge case';
  const blob = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  showNotification('Download', 'File opened in new tab');
}

function downloadWithDynamicName() {
  const timestamp = new Date().getTime();
  const filename = `report_${timestamp}.txt`;
  downloadFile(filename, 'text/plain', `Dynamic filename test: ${filename}`);
}

// File Upload Functions
function initFileUpload() {
  const dropZone = document.getElementById('dropZone');
  const fileInput = document.getElementById('fileInput');
  
  dropZone.addEventListener('click', () => fileInput.click());
  
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('dragover');
  });
  
  dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('dragover');
  });
  
  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    handleFiles(e.dataTransfer.files);
  });
  
  fileInput.addEventListener('change', (e) => {
    handleFiles(e.target.files);
  });
}

function handleFiles(files) {
  const container = document.getElementById('uploadedFiles');
  container.innerHTML = '';
  
  Array.from(files).forEach((file, index) => {
    const fileDiv = document.createElement('div');
    fileDiv.className = 'uploaded-file';
    fileDiv.setAttribute('data-testid', `uploaded-file-${index}`);
    fileDiv.innerHTML = `
      <span>üìÑ ${file.name} (${(file.size / 1024).toFixed(2)} KB)</span>
      <button class='small btn' onclick='removeFile(this)'>Remove</button>
    `;
    container.appendChild(fileDiv);
  });
  
  showNotification('Upload', `${files.length} file(s) uploaded`);
}

function removeFile(btn) {
  btn.parentElement.remove();
}

function validateFileType(input) {
  const result = document.getElementById('file-validation-result');
  const file = input.files[0];
  
  if (!file) {
    result.innerHTML = '';
    return;
  }
  
  const allowedTypes = ['.pdf', '.doc', '.docx'];
  const fileExt = '.' + file.name.split('.').pop().toLowerCase();
  const isValid = allowedTypes.includes(fileExt);
  
  result.innerHTML = `
    <p style='color: ${isValid ? 'green' : 'red'}; font-weight: bold;'>
      ${isValid ? '‚úì' : '‚úó'} File type: ${fileExt} ${isValid ? '(Valid)' : '(Invalid)'}
    </p>
  `;
}

// Iframe Functions
function initIframe() {
  const iframe = document.getElementById('iframe1');
  const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
  
  iframeDoc.open();
  iframeDoc.write(`
    <html>
    <head>
      <style>
        body { font-family: Arial; padding: 20px; background: #f0f8ff; }
        .nested-content { padding: 15px; background: white; border: 2px solid #FF9800; border-radius: 4px; margin: 10px 0; }
        input, button { padding: 8px; margin: 5px; }
      </style>
    </head>
    <body>
      <h3>Iframe Level 1 Content</h3>
      <div class='nested-content'>
        <p>This content is inside an iframe</p>
        <input type='text' placeholder='Input inside iframe' data-testid='iframe-input'>
        <button onclick='alert("Button clicked inside iframe!")' data-testid='iframe-button'>Click Me</button>
      </div>
      <div id='nested-iframe-container'></div>
      <button onclick='createNestedIframe()'>Create Nested Iframe (Level 2)</button>
      <script>
        function createNestedIframe() {
          const container = document.getElementById('nested-iframe-container');
          container.innerHTML = '<iframe id="iframe2" style="width: 100%; height: 200px; border: 2px solid #4CAF50;"></iframe>';
          const iframe2 = document.getElementById('iframe2');
          const doc2 = iframe2.contentDocument;
          doc2.open();
          doc2.write('<html><body style="padding: 20px; background: #e8f5e9;"><h4>Iframe Level 2 (Nested)</h4><p>This is a nested iframe inside another iframe</p><input type="text" placeholder="Nested iframe input" data-testid="nested-iframe-input"></body></html>');
          doc2.close();
        }
      </script>
    </body>
    </html>
  `);
  iframeDoc.close();
}

function createMultipleIframes(count) {
  const container = document.getElementById('iframe-container');
  container.innerHTML = '';
  
  for (let i = 0; i < count; i++) {
    const iframe = document.createElement('iframe');
    iframe.style.width = '100%';
    iframe.style.height = '150px';
    iframe.style.border = '1px solid #ddd';
    iframe.style.margin = '10px 0';
    iframe.setAttribute('data-testid', `multi-iframe-${i}`);
    container.appendChild(iframe);
    
    const doc = iframe.contentDocument;
    doc.open();
    doc.write(`
      <html>
      <body style='padding: 15px; background: #f5f5f5;'>
        <h4>Iframe ${i + 1}</h4>
        <p>Content for iframe number ${i + 1}</p>
        <input type='text' placeholder='Input in iframe ${i + 1}' data-testid='multi-iframe-input-${i}'>
      </body>
      </html>
    `);
    doc.close();
  }
  showNotification('Iframes', `Created ${count} iframes`);
}

function clearIframes() {
  document.getElementById('iframe-container').innerHTML = '';
  showNotification('Iframes', 'All iframes cleared');
}

// Lazy Loading Functions
let lazyPage = 0;
let lazyLoading = false;

function initLazyLoad() {
  const container = document.getElementById('lazyContainer');
  loadMoreItems();
  
  container.addEventListener('scroll', () => {
    if (lazyLoading) return;
    if (container.scrollTop + container.clientHeight >= container.scrollHeight - 50) {
      loadMoreItems();
    }
  });
}

function loadMoreItems() {
  if (lazyLoading) return;
  lazyLoading = true;
  
  const container = document.getElementById('lazyContainer');
  
  // Add skeleton loaders
  for (let i = 0; i < 3; i++) {
    const skeleton = document.createElement('div');
    skeleton.className = 'skeleton';
    container.appendChild(skeleton);
  }
  
  // Simulate loading delay
  setTimeout(() => {
    // Remove skeletons
    container.querySelectorAll('.skeleton').forEach(s => s.remove());
    
    // Add real items
    for (let i = 0; i < 10; i++) {
      const itemNum = (lazyPage * 10) + i + 1;
      const item = document.createElement('div');
      item.className = 'lazy-item';
      item.setAttribute('data-testid', `lazy-item-${itemNum}`);
      item.innerHTML = `
        <strong>Item #${itemNum}</strong>
        <p>This is lazy-loaded content. Scroll down to load more items.</p>
      `;
      container.appendChild(item);
    }
    
    lazyPage++;
    document.getElementById('itemCount').textContent = lazyPage * 10;
    lazyLoading = false;
  }, 1000);
}

function resetLazyLoad() {
  const container = document.getElementById('lazyContainer');
  container.innerHTML = '<p style="text-align: center; color: #999;">Scroll down to load more items...</p>';
  lazyPage = 0;
  lazyLoading = false;
  document.getElementById('itemCount').textContent = '0';
  loadMoreItems();
}

// Dynamic Content Functions
function toggleDynamicElement() {
  const element = document.getElementById('dynamicElement');
  element.style.display = element.style.display === 'none' ? 'block' : 'none';
}

function loadDelayedContent(delay) {
  const container = document.getElementById('delayedContent');
  container.innerHTML = '<div class="skeleton"></div>';
  
  setTimeout(() => {
    container.innerHTML = `
      <div style='padding: 15px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px;'>
        <p><strong>‚úì Content loaded after ${delay}ms delay</strong></p>
        <p>This simulates delayed API responses or slow-loading content.</p>
      </div>
    `;
  }, delay);
}

function changeAttributes() {
  const btn = document.getElementById('attributeBtn');
  const display = document.getElementById('attributeDisplay');
  
  // Change multiple attributes
  const newClass = btn.className === 'btn' ? 'btn modified' : 'btn';
  const newId = btn.id === 'attributeBtn' ? 'attributeBtnModified' : 'attributeBtn';
  const newDataAttr = Math.random().toString(36).substring(7);
  
  btn.className = newClass;
  btn.id = newId;
  btn.setAttribute('data-modified', newDataAttr);
  btn.setAttribute('aria-label', 'Modified button');
  
  display.innerHTML = `
    <p><strong>Attributes Changed:</strong></p>
    <p>Class: ${newClass}</p>
    <p>ID: ${newId}</p>
    <p>Data-modified: ${newDataAttr}</p>
    <p>Aria-label: Modified button</p>
  `;
}

// Text Validation Functions
function analyzeInvisibleChars() {
  const textBox = document.querySelector('[data-testid="invisible-char-text"]');
  const text = textBox.textContent;
  const lines = text.split('\n').filter(l => l.trim());
  
  const analysis = document.getElementById('charAnalysis');
  let html = '<div style="font-family: monospace; font-size: 12px;">';
  
  lines.forEach((line, idx) => {
    const chars = Array.from(line).map(c => {
      const code = c.charCodeAt(0);
      if (code === 32) return `<span style="background: #90EE90;">\\u0020</span>`;
      if (code === 160) return `<span style="background: #FFB6C1;">\\u00A0</span>`;
      if (code === 9) return `<span style="background: #87CEEB;">\\t</span>`;
      return c;
    }).join('');
    html += `<p>Line ${idx + 1}: ${chars}</p>`;
  });
  
  html += '</div>';
  analysis.innerHTML = html;
}

function validateSpecialChars() {
  const input = document.getElementById('specialCharsInput').value;
  const result = document.getElementById('encodingResult');
  
  const charCodes = Array.from(input).map(c => {
    const code = c.charCodeAt(0);
    return `${c} (U+${code.toString(16).toUpperCase().padStart(4, '0')})`;
  }).join(', ');
  
  result.innerHTML = `
    <div style='padding: 10px; background: #e3f2fd; border-radius: 4px;'>
      <p><strong>Character Analysis:</strong></p>
      <p style='font-family: monospace; font-size: 12px;'>${charCodes}</p>
      <p><strong>UTF-8 Encoded:</strong> ‚úì Valid</p>
    </div>
  `;
}

function compareWhitespace() {
  const result = document.getElementById('whitespaceResult');
  
  const normal = 'A B';
  const nbsp = 'A\u00A0B';
  const tab = 'A\tB';
  const newline = 'A\nB';
  
  result.innerHTML = `
    <div style='padding: 10px; background: #fff3cd; border-radius: 4px; font-family: monospace; font-size: 12px;'>
      <p><strong>Comparison Results:</strong></p>
      <p>Normal space: "${normal}" (length: ${normal.length})</p>
      <p>NBSP: "${nbsp}" (length: ${nbsp.length})</p>
      <p>Tab: "${tab}" (length: ${tab.length})</p>
      <p>Newline: "${newline}" (length: ${newline.length})</p>
      <p style='margin-top: 10px; color: #856404;'><strong>‚ö† All appear identical visually but have different character codes!</strong></p>
    </div>
  `;
}

// Resolution Functions
function updateResolutionInfo() {
  const display = document.getElementById('resolutionDisplay');
  const width = window.innerWidth;
  const height = window.innerHeight;
  const dpr = window.devicePixelRatio || 1;
  
  let deviceType = 'Desktop';
  if (width < 768) deviceType = 'Mobile';
  else if (width < 1024) deviceType = 'Tablet';
  
  display.innerHTML = `
    Viewport: ${width} √ó ${height} px | 
    Device Pixel Ratio: ${dpr} | 
    Type: ${deviceType} | 
    Orientation: ${width > height ? 'Landscape' : 'Portrait'}
  `;
  
  // Update responsive content
  const content = document.getElementById('responsiveContent');
  content.innerHTML = `
    <p><strong>Current Device Type: ${deviceType}</strong></p>
    <p>This content adapts based on viewport size. Resize the browser window to see changes.</p>
  `;
}

function simulateResize(type) {
  const sizes = {
    mobile: { width: 375, height: 667 },
    tablet: { width: 768, height: 1024 },
    desktop: { width: 1920, height: 1080 }
  };
  
  const size = sizes[type];
  showNotification('Resize', `Simulating ${type} viewport: ${size.width}√ó${size.height}px`);
  
  // Note: Actual window resizing is restricted by browsers for security
  // This just updates the display to show what would happen
  const display = document.getElementById('resolutionDisplay');
  display.innerHTML = `
    <span style='color: #FF9800;'>‚ö† Simulated ${type.toUpperCase()}</span> | 
    Viewport: ${size.width} √ó ${size.height} px | 
    (Actual browser resize restricted for security)
  `;
}

// Form Submission
function handleFormSubmit(event) {
  event.preventDefault();
  
  const formData = new FormData(event.target);
  const data = Object.fromEntries(formData.entries());
  
  const result = document.getElementById('formResult');
  result.style.display = 'block';
  result.style.padding = '15px';
  result.style.background = '#d4edda';
  result.style.border = '1px solid #c3e6cb';
  result.style.borderRadius = '4px';
  result.innerHTML = `
    <p><strong>‚úì Form Submitted Successfully!</strong></p>
    <p><strong>Submitted Data:</strong></p>
    <pre style='background: white; padding: 10px; border-radius: 4px; overflow-x: auto;'>${JSON.stringify(data, null, 2)}</pre>
  `;
  
  showNotification('Form', 'Form submitted successfully!');
}

// Shadow DOM Functions
function createShadowDOM() {
  const host = document.getElementById('shadowHost');
  host.innerHTML = '';
  
  const shadow = host.attachShadow({ mode: 'open' });
  shadow.innerHTML = `
    <style>
      .shadow-content { padding: 20px; background: #e3f2fd; border: 2px solid #2196F3; border-radius: 8px; }
      input, button { padding: 8px; margin: 5px; }
    </style>
    <div class='shadow-content'>
      <h4>Content Inside Shadow DOM</h4>
      <p>This content is encapsulated in Shadow DOM</p>
      <input type='text' placeholder='Shadow DOM input' data-testid='shadow-input'>
      <button data-testid='shadow-button'>Click Me</button>
    </div>
  `;
  
  shadow.querySelector('button').addEventListener('click', () => {
    alert('Button inside Shadow DOM clicked!');
  });
  
  document.getElementById('shadowResult').innerHTML = '<p style="color: green;">‚úì Shadow DOM created successfully</p>';
}

function createNestedShadowDOM() {
  const host = document.getElementById('shadowHost');
  host.innerHTML = '';
  
  const shadow = host.attachShadow({ mode: 'open' });
  shadow.innerHTML = `
    <style>
      .shadow-content { padding: 20px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; }
      .nested-host { margin-top: 15px; }
    </style>
    <div class='shadow-content'>
      <h4>Level 1 Shadow DOM</h4>
      <p>This contains a nested Shadow DOM</p>
      <div class='nested-host' id='nestedHost'></div>
    </div>
  `;
  
  const nestedHost = shadow.getElementById('nestedHost');
  const nestedShadow = nestedHost.attachShadow({ mode: 'open' });
  nestedShadow.innerHTML = `
    <style>
      .nested-content { padding: 15px; background: #e8f5e9; border: 2px solid #4CAF50; border-radius: 4px; }
    </style>
    <div class='nested-content'>
      <h5>Level 2 Shadow DOM (Nested)</h5>
      <input type='text' placeholder='Nested shadow input' data-testid='nested-shadow-input'>
    </div>
  `;
  
  document.getElementById('shadowResult').innerHTML = '<p style="color: green;">‚úì Nested Shadow DOM created successfully</p>';
}

// Hover & Mouse Event Functions
function initHoverEvents() {
  const btn = document.getElementById('hoverBtn');
  const dropdown = document.getElementById('hoverDropdown');
  
  btn.addEventListener('mouseenter', () => {
    dropdown.style.display = 'block';
  });
  
  btn.addEventListener('mouseleave', () => {
    setTimeout(() => {
      if (!dropdown.matches(':hover')) {
        dropdown.style.display = 'none';
      }
    }, 100);
  });
  
  dropdown.addEventListener('mouseleave', () => {
    dropdown.style.display = 'none';
  });
}

function initMouseTracking() {
  const tracker = document.getElementById('mouseTracker');
  const events = document.getElementById('mouseEvents');
  let eventLog = [];
  
  const logEvent = (type, x, y) => {
    eventLog.unshift(`${type}: (${x}, ${y})`);
    if (eventLog.length > 5) eventLog.pop();
    events.innerHTML = eventLog.join('<br>');
  };
  
  tracker.addEventListener('mouseenter', (e) => logEvent('mouseenter', e.clientX, e.clientY));
  tracker.addEventListener('mouseleave', (e) => logEvent('mouseleave', e.clientX, e.clientY));
  tracker.addEventListener('mousemove', (e) => logEvent('mousemove', e.clientX, e.clientY));
  tracker.addEventListener('click', (e) => logEvent('click', e.clientX, e.clientY));
}

// Initialize hover events on page load
onReady(() => {
  // Initialize resolution display
  updateResolutionInfo();
  
  // Initialize lazy loading
  initLazyLoad();
  
  // Initialize iframe content
  initIframe();
  
  // Initialize file upload
  initFileUpload();
  
  // Initialize hover events
  initHoverEvents();
  
  // Initialize mouse tracking
  initMouseTracking();
  
  // Update resolution on window resize
  window.addEventListener('resize', updateResolutionInfo);
});
</script>
</body>
</html>
