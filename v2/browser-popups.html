<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Native Popups - QA Playground</title>
    <link rel="stylesheet" href="../shared/styles.css">
    <style>
        .popup-trigger {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        .warning {
            background: #ffebee;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #f44336;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .popup-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .popup-card h3 {
            margin-top: 0;
            color: #1976d2;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }
        .status-triggered {
            background: #4caf50;
            color: white;
        }
        .status-pending {
            background: #ff9800;
            color: white;
        }
        input[type="text"], input[type="password"], input[type="email"] {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <header>
        <div>
            <h1>Browser Native Popups Testing</h1>
            <div class="small">Test automation handling of browser-native permission popups and dialogs</div>
        </div>
        <nav>
            <a href="../index.html">Home</a>
        </nav>
    </header>

    <main>
        <section class="card">
            <div class="warning">
                <strong>‚ö†Ô∏è Important:</strong> These popups are browser-native and cannot be controlled via JavaScript. 
                They test your automation tool's ability to handle browser permission dialogs.
                Based on LCNC tickets: 10074, 11020, 11090, 9652, 9734, 9626
            </div>
        </section>

        <!-- Geolocation Permission Popup -->
        <section class="card">
            <div class="popup-card">
                <h3>üìç Geolocation Permission (LCNC-9652, LCNC-9734)</h3>
                <p class="small">Triggers browser's location permission popup</p>
                
                <button class="btn" id="requestLocation" data-testid="request-location">
                    Request Location Access
                </button>
                
                <div class="info" style="margin-top: 15px;">
                    <strong>Status:</strong> <span id="locationStatus" data-testid="location-status">Not requested</span><br>
                    <strong>Coordinates:</strong> <span id="coordinates" data-testid="coordinates">-</span>
                </div>
                
                <div class="popup-trigger">
                    <strong>Expected Popup:</strong> "Allow [site] to access your location?"
                </div>
            </div>
        </section>

        <!-- Notification Permission Popup -->
        <section class="card">
            <div class="popup-card">
                <h3>üîî Notification Permission (LCNC-11090)</h3>
                <p class="small">Triggers browser's notification permission popup</p>
                
                <button class="btn" id="requestNotification" data-testid="request-notification">
                    Request Notification Permission
                </button>
                
                <button class="btn" id="sendNotification" data-testid="send-notification" disabled>
                    Send Test Notification
                </button>
                
                <div class="info" style="margin-top: 15px;">
                    <strong>Permission:</strong> <span id="notificationStatus" data-testid="notification-status">Not requested</span>
                </div>
                
                <div class="popup-trigger">
                    <strong>Expected Popup:</strong> "Allow [site] to send notifications?"
                </div>
            </div>
        </section>

        <!-- Camera Permission Popup -->
        <section class="card">
            <div class="popup-card">
                <h3>üì∑ Camera Permission (LCNC-9626)</h3>
                <p class="small">Triggers browser's camera access permission popup</p>
                
                <button class="btn" id="requestCamera" data-testid="request-camera">
                    Request Camera Access
                </button>
                
                <div class="info" style="margin-top: 15px;">
                    <strong>Status:</strong> <span id="cameraStatus" data-testid="camera-status">Not requested</span>
                </div>
                
                <video id="cameraPreview" width="320" height="240" autoplay style="display:none; margin-top: 15px; border-radius: 8px;"></video>
                
                <div class="popup-trigger">
                    <strong>Expected Popup:</strong> "Allow [site] to use your camera?"
                </div>
            </div>
        </section>

        <!-- Microphone Permission Popup -->
        <section class="card">
            <div class="popup-card">
                <h3>üé§ Microphone Permission</h3>
                <p class="small">Triggers browser's microphone access permission popup</p>
                
                <button class="btn" id="requestMicrophone" data-testid="request-microphone">
                    Request Microphone Access
                </button>
                
                <div class="info" style="margin-top: 15px;">
                    <strong>Status:</strong> <span id="microphoneStatus" data-testid="microphone-status">Not requested</span>
                </div>
                
                <div class="popup-trigger">
                    <strong>Expected Popup:</strong> "Allow [site] to use your microphone?"
                </div>
            </div>
        </section>

        <!-- Save Password Popup -->
        <section class="card">
            <div class="popup-card">
                <h3>üîë Save Password Popup (LCNC-10074)</h3>
                <p class="small">Triggers browser's save password prompt</p>
                
                <form id="loginForm" data-testid="login-form">
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="username" data-testid="username" 
                               placeholder="Enter username" autocomplete="username">
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="password" data-testid="password" 
                               placeholder="Enter password" autocomplete="current-password">
                    </div>
                    
                    <button type="submit" class="btn" data-testid="login-submit">
                        Login (Trigger Save Password)
                    </button>
                </form>
                
                <div class="info" style="margin-top: 15px;">
                    <strong>Login Status:</strong> <span id="loginStatus" data-testid="login-status">Not logged in</span>
                </div>
                
                <div class="popup-trigger">
                    <strong>Expected Popup:</strong> "Save password for this site?"
                </div>
            </div>
        </section>

        <!-- Save Card Popup -->
        <section class="card">
            <div class="popup-card">
                <h3>üí≥ Save Card Popup (LCNC-10074, LCNC-11020)</h3>
                <p class="small">Triggers browser's save credit card prompt</p>
                
                <form id="paymentForm" data-testid="payment-form">
                    <div class="form-group">
                        <label for="cardNumber">Card Number:</label>
                        <input type="text" id="cardNumber" name="cardnumber" data-testid="card-number" 
                               placeholder="1234 5678 9012 3456" autocomplete="cc-number" 
                               pattern="[0-9\s]{13,19}" maxlength="19">
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="cardExpiry">Expiry (MM/YY):</label>
                            <input type="text" id="cardExpiry" name="cc-exp" data-testid="card-expiry" 
                                   placeholder="12/25" autocomplete="cc-exp" pattern="[0-9]{2}/[0-9]{2}" maxlength="5">
                        </div>
                        
                        <div class="form-group">
                            <label for="cardCVV">CVV:</label>
                            <input type="text" id="cardCVV" name="cc-csc" data-testid="card-cvv" 
                                   placeholder="123" autocomplete="cc-csc" pattern="[0-9]{3,4}" maxlength="4">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cardName">Cardholder Name:</label>
                        <input type="text" id="cardName" name="cc-name" data-testid="card-name" 
                               placeholder="John Doe" autocomplete="cc-name">
                    </div>
                    
                    <button type="submit" class="btn" data-testid="payment-submit">
                        Submit Payment (Trigger Save Card)
                    </button>
                </form>
                
                <div class="info" style="margin-top: 15px;">
                    <strong>Payment Status:</strong> <span id="paymentStatus" data-testid="payment-status">Not submitted</span>
                </div>
                
                <div class="popup-trigger">
                    <strong>Expected Popup:</strong> "Save card for faster checkout?"
                </div>
            </div>
        </section>

        <!-- Multiple Popups Sequence -->
        <section class="card">
            <h2>üîÑ Multiple Popups Sequence</h2>
            <p class="small">Test handling multiple permission popups in sequence</p>
            
            <div class="grid-3">
                <button class="btn" id="triggerSequence1" data-testid="trigger-sequence-1">
                    Location ‚Üí Notification
                </button>
                <button class="btn" id="triggerSequence2" data-testid="trigger-sequence-2">
                    Camera ‚Üí Microphone
                </button>
                <button class="btn" id="triggerSequence3" data-testid="trigger-sequence-3">
                    All Permissions
                </button>
            </div>
            
            <div class="info">
                <strong>Sequence Status:</strong> <span id="sequenceStatus" data-testid="sequence-status">Ready</span>
            </div>
        </section>

        <!-- Popup Interference Testing -->
        <section class="card">
            <h2>‚ö†Ô∏è Popup Interference Scenarios</h2>
            <p class="small">Test automation when popups interfere with element interactions</p>
            
            <div class="popup-card">
                <h3>Scenario: Form Fill with Popup Interference</h3>
                
                <button class="btn" id="startInterference" data-testid="start-interference">
                    Start Test (Triggers Location Popup)
                </button>
                
                <form id="interferenceForm" style="margin-top: 20px; display: none;" data-testid="interference-form">
                    <div class="form-group">
                        <label for="field1">Field 1:</label>
                        <input type="text" id="field1" data-testid="field-1" placeholder="Fill this while popup is active">
                    </div>
                    
                    <div class="form-group">
                        <label for="field2">Field 2:</label>
                        <input type="text" id="field2" data-testid="field-2" placeholder="Fill this after popup">
                    </div>
                    
                    <button type="button" class="btn" id="submitInterference" data-testid="submit-interference">
                        Submit Form
                    </button>
                </form>
                
                <div class="info" style="margin-top: 15px;">
                    <strong>Test Status:</strong> <span id="interferenceStatus" data-testid="interference-status">Not started</span>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Geolocation Permission
        document.getElementById('requestLocation').addEventListener('click', function() {
            const statusEl = document.getElementById('locationStatus');
            const coordsEl = document.getElementById('coordinates');
            
            statusEl.textContent = 'Requesting...';
            
            if ('geolocation' in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        statusEl.textContent = 'Granted';
                        coordsEl.textContent = `Lat: ${position.coords.latitude.toFixed(4)}, Lon: ${position.coords.longitude.toFixed(4)}`;
                    },
                    function(error) {
                        statusEl.textContent = 'Denied or Error: ' + error.message;
                        coordsEl.textContent = 'N/A';
                    }
                );
            } else {
                statusEl.textContent = 'Not supported';
            }
        });

        // Notification Permission
        document.getElementById('requestNotification').addEventListener('click', function() {
            const statusEl = document.getElementById('notificationStatus');
            const sendBtn = document.getElementById('sendNotification');
            
            if ('Notification' in window) {
                Notification.requestPermission().then(function(permission) {
                    statusEl.textContent = permission.charAt(0).toUpperCase() + permission.slice(1);
                    if (permission === 'granted') {
                        sendBtn.disabled = false;
                    }
                });
            } else {
                statusEl.textContent = 'Not supported';
            }
        });

        document.getElementById('sendNotification').addEventListener('click', function() {
            if (Notification.permission === 'granted') {
                new Notification('Test Notification', {
                    body: 'This is a test notification from QA Playground',
                    icon: '../shared/placeholder.png'
                });
            }
        });

        // Camera Permission
        document.getElementById('requestCamera').addEventListener('click', function() {
            const statusEl = document.getElementById('cameraStatus');
            const videoEl = document.getElementById('cameraPreview');
            
            statusEl.textContent = 'Requesting...';
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    statusEl.textContent = 'Granted';
                    videoEl.style.display = 'block';
                    videoEl.srcObject = stream;
                })
                .catch(function(error) {
                    statusEl.textContent = 'Denied or Error: ' + error.message;
                    videoEl.style.display = 'none';
                });
        });

        // Microphone Permission
        document.getElementById('requestMicrophone').addEventListener('click', function() {
            const statusEl = document.getElementById('microphoneStatus');
            
            statusEl.textContent = 'Requesting...';
            
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function(stream) {
                    statusEl.textContent = 'Granted';
                    stream.getTracks().forEach(track => track.stop());
                })
                .catch(function(error) {
                    statusEl.textContent = 'Denied or Error: ' + error.message;
                });
        });

        // Login Form (Save Password)
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const statusEl = document.getElementById('loginStatus');
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username && password) {
                // Simulate login
                setTimeout(function() {
                    statusEl.textContent = 'Logged in as ' + username;
                    // Browser should show save password popup here
                }, 500);
            } else {
                statusEl.textContent = 'Please fill all fields';
            }
        });

        // Payment Form (Save Card)
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const statusEl = document.getElementById('paymentStatus');
            const cardNumber = document.getElementById('cardNumber').value;
            const cardName = document.getElementById('cardName').value;
            
            if (cardNumber && cardName) {
                // Simulate payment
                setTimeout(function() {
                    statusEl.textContent = 'Payment processed successfully';
                    // Browser should show save card popup here
                }, 500);
            } else {
                statusEl.textContent = 'Please fill all fields';
            }
        });

        // Multiple Popups Sequences
        document.getElementById('triggerSequence1').addEventListener('click', function() {
            const statusEl = document.getElementById('sequenceStatus');
            statusEl.textContent = 'Requesting Location...';
            
            navigator.geolocation.getCurrentPosition(
                function() {
                    statusEl.textContent = 'Location granted, requesting Notification...';
                    Notification.requestPermission().then(function(permission) {
                        statusEl.textContent = 'Sequence complete: Location + Notification';
                    });
                },
                function() {
                    statusEl.textContent = 'Location denied';
                }
            );
        });

        document.getElementById('triggerSequence2').addEventListener('click', function() {
            const statusEl = document.getElementById('sequenceStatus');
            statusEl.textContent = 'Requesting Camera...';
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    stream.getTracks().forEach(track => track.stop());
                    statusEl.textContent = 'Camera granted, requesting Microphone...';
                    
                    return navigator.mediaDevices.getUserMedia({ audio: true });
                })
                .then(function(stream) {
                    stream.getTracks().forEach(track => track.stop());
                    statusEl.textContent = 'Sequence complete: Camera + Microphone';
                })
                .catch(function() {
                    statusEl.textContent = 'Permission denied';
                });
        });

        document.getElementById('triggerSequence3').addEventListener('click', function() {
            const statusEl = document.getElementById('sequenceStatus');
            statusEl.textContent = 'Requesting all permissions...';
            
            Promise.all([
                navigator.geolocation.getCurrentPosition(() => {}, () => {}),
                Notification.requestPermission(),
                navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                    .then(stream => stream.getTracks().forEach(track => track.stop()))
                    .catch(() => {})
            ]).finally(function() {
                statusEl.textContent = 'All permission requests sent';
            });
        });

        // Popup Interference Test
        document.getElementById('startInterference').addEventListener('click', function() {
            const formEl = document.getElementById('interferenceForm');
            const statusEl = document.getElementById('interferenceStatus');
            
            // Trigger location popup
            navigator.geolocation.getCurrentPosition(() => {}, () => {});
            
            // Show form immediately (popup will interfere)
            formEl.style.display = 'block';
            statusEl.textContent = 'Form visible - Location popup should be blocking';
        });

        document.getElementById('submitInterference').addEventListener('click', function() {
            const statusEl = document.getElementById('interferenceStatus');
            const field1 = document.getElementById('field1').value;
            const field2 = document.getElementById('field2').value;
            
            if (field1 && field2) {
                statusEl.textContent = 'Form submitted successfully despite popup!';
            } else {
                statusEl.textContent = 'Please fill all fields';
            }
        });
    </script>
</body>
</html>