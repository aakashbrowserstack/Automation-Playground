<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<title>LCNC Edge Cases - Comprehensive Test Suite</title>
<link rel='stylesheet' href='../shared/styles.css'>
<style>
.test-section { margin: 30px 0; padding: 20px; border: 2px solid #ddd; border-radius: 8px; }
.test-section h3 { margin-top: 0; color: #2196F3; }
.test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
.test-card { padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; }
.test-card h4 { margin-top: 0; font-size: 16px; }
.notification-box { position: fixed; top: 20px; right: 20px; padding: 15px 20px; background: #4CAF50; color: white; border-radius: 4px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 10000; display: none; }
.notification-box.show { display: block; animation: slideIn 0.3s; }
@keyframes slideIn { from { transform: translateX(400px); } to { transform: translateX(0); } }
</style>
</head>
<body>
<a href='../index.html' class='small btn'>Back</a>

<section class='card'>
<h2>LCNC Edge Cases - Comprehensive Test Suite</h2>
<p style='color: #666; margin-bottom: 30px;'>Based on Q2 2024 ticket analysis - Testing critical edge cases</p>

<div id='notification' class='notification-box' data-testid='notification-box'></div>

<!-- Section 1: Browser Dialogs -->
<div class='test-section'>
  <h3>1. Browser Popups & Notifications</h3>
  <div class='test-grid'>
    <div class='test-card'>
      <h4>Simulated Notifications</h4>
      <button class='btn' onclick='showNotification("Success", "Operation completed!")' data-testid='show-success'>Show Success</button>
      <button class='btn' onclick='showNotification("Warning", "Please review")' data-testid='show-warning'>Show Warning</button>
    </div>
    <div class='test-card'>
      <h4>Confirm Dialog</h4>
      <button class='btn' onclick='triggerConfirm()' data-testid='trigger-confirm'>Trigger Confirm</button>
      <div id='confirm-result' style='margin-top: 10px;' data-testid='confirm-result'></div>
    </div>
  </div>
</div>

<!-- Section 2: File Operations -->
<div class='test-section'>
  <h3>2. File Download/Upload Edge Cases</h3>
  <div class='test-grid'>
    <div class='test-card'>
      <h4>File Downloads</h4>
      <button class='btn' onclick='downloadFile("sample.txt", "text/plain", "Test content")' data-testid='download-txt'>Download TXT</button>
      <button class='btn' onclick='downloadFile("data.csv", "text/csv", "Name,Email\nJohn,john@test.com")' data-testid='download-csv'>Download CSV</button>
    </div>
    <div class='test-card'>
      <h4>File Upload</h4>
      <input type='file' id='fileInput' multiple data-testid='file-input'>
      <div id='uploadedFiles' style='margin-top: 10px;' data-testid='uploaded-files'></div>
    </div>
  </div>
</div>

<!-- Section 3: Dynamic Content -->
<div class='test-section'>
  <h3>3. Dynamic Content & DOM Changes</h3>
  <div class='test-grid'>
    <div class='test-card'>
      <h4>Toggle Element</h4>
      <button class='btn' onclick='toggleElement()' data-testid='toggle-btn'>Toggle Element</button>
      <div id='dynamicElement' style='display: none; margin-top: 10px; padding: 15px; background: #e3f2fd; border-radius: 4px;' data-testid='dynamic-element'>
        <p>This element appears and disappears!</p>
      </div>
    </div>
    <div class='test-card'>
      <h4>Delayed Content</h4>
      <button class='btn' onclick='loadDelayed(2000)' data-testid='load-2s'>Load (2s delay)</button>
      <div id='delayedContent' style='margin-top: 10px;' data-testid='delayed-content'></div>
    </div>
  </div>
</div>

<!-- Section 4: Form Validation -->
<div class='test-section'>
  <h3>4. Form Submission & Validation</h3>
  <div class='test-card'>
    <form id='testForm' onsubmit='handleSubmit(event)' data-testid='test-form'>
      <div style='margin: 10px 0;'>
        <label>Email:</label>
        <input type='email' name='email' required data-testid='form-email'>
      </div>
      <div style='margin: 10px 0;'>
        <label>Phone (XXX-XXX-XXXX):</label>
        <input type='tel' name='phone' pattern='[0-9]{3}-[0-9]{3}-[0-9]{4}' data-testid='form-phone'>
      </div>
      <div style='margin: 10px 0;'>
        <label>
          <input type='checkbox' name='terms' required data-testid='form-terms'>
          I agree to terms
        </label>
      </div>
      <button type='submit' class='btn' data-testid='form-submit'>Submit</button>
    </form>
    <div id='formResult' style='margin-top: 15px; display: none;' data-testid='form-result'></div>
  </div>
</div>

<!-- Section 5: Iframe & Nested Iframes -->
<div class='test-section'>
  <h3>5. Iframe & Nested Iframe Scenarios (LCNC-10456, 9886)</h3>
  <div class='test-card'>
    <h4>Single Iframe</h4>
    <iframe id='iframe1' style='width: 100%; height: 200px; border: 1px solid #ddd;' data-testid='iframe-1'></iframe>
  </div>
  <div class='test-card'>
    <h4>Multiple Iframes</h4>
    <button class='btn' onclick='createIframes(5)' data-testid='create-5-iframes'>Create 5 Iframes</button>
    <button class='btn' onclick='clearIframes()' data-testid='clear-iframes'>Clear All</button>
    <div id='iframeContainer' style='margin-top: 10px;' data-testid='iframe-container'></div>
  </div>
</div>

<!-- Section 6: Lazy Loading & Infinite Scroll -->
<div class='test-section'>
  <h3>6. Lazy Loading & Infinite Scroll (LCNC-9889)</h3>
  <div class='test-card'>
    <h4>Infinite Scroll Container</h4>
    <div id='lazyContainer' style='height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;' data-testid='lazy-container'>
      <p style='text-align: center; color: #999;'>Scroll down to load more items...</p>
    </div>
    <div style='margin-top: 10px;'>
      Items Loaded: <strong id='itemCount' data-testid='item-count'>0</strong>
      <button class='btn' onclick='resetLazy()' style='margin-left: 10px;' data-testid='reset-lazy'>Reset</button>
    </div>
  </div>
</div>

<!-- Section 7: Text Validation Edge Cases -->
<div class='test-section'>
  <h3>7. Text Validation Edge Cases (LCNC-9577)</h3>
  <div class='test-grid'>
    <div class='test-card'>
      <h4>Invisible Characters</h4>
      <div style='padding: 10px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-family: monospace;' data-testid='invisible-chars'>
Regular space: "Hello World"
Non-breaking space: "Hello World"
      </div>
      <button class='btn' onclick='analyzeChars()' data-testid='analyze-chars'>Analyze Characters</button>
      <div id='charResult' style='margin-top: 10px;' data-testid='char-result'></div>
    </div>
    <div class='test-card'>
      <h4>Special Characters</h4>
      <textarea id='specialChars' rows='3' style='width: 100%; padding: 8px;' data-testid='special-chars'>Test™ © ® € £ ¥</textarea>
      <button class='btn' onclick='validateChars()' data-testid='validate-chars'>Validate Encoding</button>
      <div id='encodeResult' style='margin-top: 10px;' data-testid='encode-result'></div>
    </div>
  </div>
</div>

<!-- Section 8: Browser Resolution Changes -->
<div class='test-section'>
  <h3>8. Browser Resolution & Viewport (LCNC-10141, 10490)</h3>
  <div class='test-card'>
    <h4>Current Viewport Info</h4>
    <div id='resolutionInfo' style='padding: 10px; background: #e8f5e9; border: 1px solid #4CAF50; border-radius: 4px; font-weight: bold;' data-testid='resolution-info'>
      Loading...
    </div>
    <div style='margin-top: 10px;'>
      <button class='btn' onclick='updateResolution()' data-testid='update-resolution'>Refresh Info</button>
    </div>
  </div>
</div>

<!-- Section 9: Shadow DOM & Custom Elements -->
<div class='test-section'>
  <h3>9. Shadow DOM & Custom Elements (LCNC-10797)</h3>
  <div class='test-card'>
    <h4>Shadow DOM Elements</h4>
    <div id='shadowHost' data-testid='shadow-host'></div>
    <button class='btn' onclick='createShadow()' data-testid='create-shadow'>Create Shadow DOM</button>
    <button class='btn' onclick='createNestedShadow()' data-testid='create-nested-shadow'>Create Nested Shadow</button>
    <div id='shadowResult' style='margin-top: 10px;' data-testid='shadow-result'></div>
  </div>
</div>

<!-- Section 10: Hover & Mouse Events -->
<div class='test-section'>
  <h3>10. Hover & Mouse Events (LCNC-11091)</h3>
  <div class='test-grid'>
    <div class='test-card'>
      <h4>Hover Dropdown</h4>
      <div style='position: relative;'>
        <button class='btn' id='hoverBtn' data-testid='hover-btn'>Hover Over Me</button>
        <div id='hoverDropdown' style='display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ddd; padding: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 100;' data-testid='hover-dropdown'>
          <p><strong>Dropdown Content</strong></p>
          <button class='small btn' data-testid='dropdown-option-1'>Option 1</button>
        </div>
      </div>
    </div>
    <div class='test-card'>
      <h4>Mouse Event Tracking</h4>
      <div id='mouseTracker' style='padding: 30px; background: #f5f5f5; border: 2px solid #ddd; border-radius: 4px; text-align: center;' data-testid='mouse-tracker'>
        Move mouse here
      </div>
      <div id='mouseEvents' style='margin-top: 10px; font-family: monospace; font-size: 12px;' data-testid='mouse-events'></div>
    </div>
  </div>
</div>

</section>

<script src='../shared/scripts.js'></script>
<script>
onReady(() => {
  initFileUpload();
});

function showNotification(title, message) {
  const notification = document.getElementById('notification');
  notification.innerHTML = '<strong>' + title + ':</strong> ' + message;
  notification.className = 'notification-box show';
  setTimeout(() => {
    notification.className = 'notification-box';
  }, 3000);
}

function triggerConfirm() {
  const result = confirm('Do you want to proceed?');
  const resultDiv = document.getElementById('confirm-result');
  resultDiv.innerHTML = '<p>User selected: <strong>' + (result ? 'OK' : 'Cancel') + '</strong></p>';
  resultDiv.style.color = result ? 'green' : 'red';
}

function downloadFile(filename, mimeType, content) {
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  showNotification('Download', filename + ' download started');
}

function initFileUpload() {
  const fileInput = document.getElementById('fileInput');
  fileInput.addEventListener('change', (e) => {
    const container = document.getElementById('uploadedFiles');
    container.innerHTML = '';
    Array.from(e.target.files).forEach((file, index) => {
      const fileDiv = document.createElement('div');
      fileDiv.style.padding = '8px';
      fileDiv.style.margin = '5px 0';
      fileDiv.style.background = '#e3f2fd';
      fileDiv.style.borderRadius = '4px';
      fileDiv.setAttribute('data-testid', 'uploaded-file-' + index);
      fileDiv.textContent = file.name + ' (' + (file.size / 1024).toFixed(2) + ' KB)';
      container.appendChild(fileDiv);
    });
    showNotification('Upload', e.target.files.length + ' file(s) uploaded');
  });
}

function toggleElement() {
  const element = document.getElementById('dynamicElement');
  element.style.display = element.style.display === 'none' ? 'block' : 'none';
}

function loadDelayed(delay) {
  const container = document.getElementById('delayedContent');
  container.innerHTML = '<p style="color: #999;">Loading...</p>';
  setTimeout(() => {
    container.innerHTML = '<div style="padding: 15px; background: #d4edda; border-radius: 4px;"><p><strong>✓ Content loaded after ' + delay + 'ms delay</strong></p></div>';
  }, delay);
}

function handleSubmit(event) {
  event.preventDefault();
  const formData = new FormData(event.target);
  const data = Object.fromEntries(formData.entries());
  const result = document.getElementById('formResult');
  result.style.display = 'block';
  result.style.padding = '15px';
  result.style.background = '#d4edda';
  result.style.borderRadius = '4px';
  result.innerHTML = '<p><strong>✓ Form Submitted Successfully!</strong></p><pre>' + JSON.stringify(data, null, 2) + '</pre>';
  showNotification('Form', 'Form submitted successfully!');
}

// Section 5: Iframe Functions
function initIframe() {
  const iframe = document.getElementById('iframe1');
  const doc = iframe.contentDocument || iframe.contentWindow.document;
  doc.open();
  doc.write('<html><body style="padding: 20px; background: #f0f8ff;"><h3>Iframe Content</h3><p>This is content inside an iframe</p><input type="text" placeholder="Input inside iframe" data-testid="iframe-input"></body></html>');
  doc.close();
}

function createIframes(count) {
  const container = document.getElementById('iframeContainer');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const iframe = document.createElement('iframe');
    iframe.style.width = '100%';
    iframe.style.height = '100px';
    iframe.style.border = '1px solid #ddd';
    iframe.style.margin = '5px 0';
    iframe.setAttribute('data-testid', 'multi-iframe-' + i);
    container.appendChild(iframe);
    const doc = iframe.contentDocument;
    doc.open();
    doc.write('<html><body style="padding: 10px;"><p>Iframe ' + (i + 1) + '</p></body></html>');
    doc.close();
  }
  showNotification('Iframes', count + ' iframes created');
}

function clearIframes() {
  document.getElementById('iframeContainer').innerHTML = '';
  showNotification('Iframes', 'All iframes cleared');
}

// Section 6: Lazy Loading Functions
let lazyPage = 0;
let lazyLoading = false;

function initLazy() {
  const container = document.getElementById('lazyContainer');
  loadMoreItems();
  container.addEventListener('scroll', () => {
    if (lazyLoading) return;
    if (container.scrollTop + container.clientHeight >= container.scrollHeight - 50) {
      loadMoreItems();
    }
  });
}

function loadMoreItems() {
  if (lazyLoading) return;
  lazyLoading = true;
  const container = document.getElementById('lazyContainer');
  setTimeout(() => {
    for (let i = 0; i < 10; i++) {
      const itemNum = (lazyPage * 10) + i + 1;
      const item = document.createElement('div');
      item.style.padding = '10px';
      item.style.margin = '5px 0';
      item.style.background = '#f5f5f5';
      item.style.border = '1px solid #ddd';
      item.style.borderRadius = '4px';
      item.setAttribute('data-testid', 'lazy-item-' + itemNum);
      item.innerHTML = '<strong>Item #' + itemNum + '</strong><p>Lazy-loaded content</p>';
      container.appendChild(item);
    }
    lazyPage++;
    document.getElementById('itemCount').textContent = lazyPage * 10;
    lazyLoading = false;
  }, 500);
}

function resetLazy() {
  const container = document.getElementById('lazyContainer');
  container.innerHTML = '<p style="text-align: center; color: #999;">Scroll down to load more items...</p>';
  lazyPage = 0;
  lazyLoading = false;
  document.getElementById('itemCount').textContent = '0';
  loadMoreItems();
}

// Section 7: Text Validation Functions
function analyzeChars() {
  const textBox = document.querySelector('[data-testid="invisible-chars"]');
  const text = textBox.textContent;
  const result = document.getElementById('charResult');
  const lines = text.split('\n').filter(l => l.trim());
  let html = '<div style="font-family: monospace; font-size: 12px;">';
  lines.forEach((line, idx) => {
    const hasNBSP = line.includes('\u00A0');
    const hasSpace = line.includes(' ');
    html += '<p>Line ' + (idx + 1) + ': ' + (hasNBSP ? 'Contains NBSP (\\u00A0)' : 'Contains regular space (\\u0020)') + '</p>';
  });
  html += '</div>';
  result.innerHTML = html;
}

function validateChars() {
  const input = document.getElementById('specialChars').value;
  const result = document.getElementById('encodeResult');
  const charCodes = Array.from(input).map(c => {
    const code = c.charCodeAt(0);
    return c + ' (U+' + code.toString(16).toUpperCase().padStart(4, '0') + ')';
  }).join(', ');
  result.innerHTML = '<div style="padding: 10px; background: #e3f2fd; border-radius: 4px;"><p><strong>Character Analysis:</strong></p><p style="font-size: 12px;">' + charCodes + '</p></div>';
}

// Section 8: Resolution Functions
function updateResolution() {
  const display = document.getElementById('resolutionInfo');
  const width = window.innerWidth;
  const height = window.innerHeight;
  const dpr = window.devicePixelRatio || 1;
  let deviceType = 'Desktop';
  if (width < 768) deviceType = 'Mobile';
  else if (width < 1024) deviceType = 'Tablet';
  display.innerHTML = 'Viewport: ' + width + ' × ' + height + ' px | DPR: ' + dpr + ' | Type: ' + deviceType;
}

// Section 9: Shadow DOM Functions
function createShadow() {
  const host = document.getElementById('shadowHost');
  host.innerHTML = '';
  const shadow = host.attachShadow({ mode: 'open' });
  shadow.innerHTML = '<div style="padding: 20px; background: #e3f2fd; border: 2px solid #2196F3; border-radius: 8px;"><h4>Shadow DOM Content</h4><p>This content is encapsulated in Shadow DOM</p><input type="text" placeholder="Shadow DOM input" data-testid="shadow-input"></div>';
  document.getElementById('shadowResult').innerHTML = '<p style="color: green;">✓ Shadow DOM created</p>';
}

function createNestedShadow() {
  const host = document.getElementById('shadowHost');
  host.innerHTML = '';
  const shadow = host.attachShadow({ mode: 'open' });
  shadow.innerHTML = '<div style="padding: 20px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;"><h4>Level 1 Shadow DOM</h4><div id="nestedHost"></div></div>';
  const nestedHost = shadow.getElementById('nestedHost');
  const nestedShadow = nestedHost.attachShadow({ mode: 'open' });
  nestedShadow.innerHTML = '<div style="padding: 15px; background: #e8f5e9; border: 2px solid #4CAF50; border-radius: 4px;"><h5>Level 2 Shadow DOM (Nested)</h5><input type="text" placeholder="Nested shadow input" data-testid="nested-shadow-input"></div>';
  document.getElementById('shadowResult').innerHTML = '<p style="color: green;">✓ Nested Shadow DOM created</p>';
}

// Section 10: Hover & Mouse Event Functions
function initHover() {
  const btn = document.getElementById('hoverBtn');
  const dropdown = document.getElementById('hoverDropdown');
  btn.addEventListener('mouseenter', () => {
    dropdown.style.display = 'block';
  });
  btn.addEventListener('mouseleave', () => {
    setTimeout(() => {
      if (!dropdown.matches(':hover')) {
        dropdown.style.display = 'none';
      }
    }, 100);
  });
  dropdown.addEventListener('mouseleave', () => {
    dropdown.style.display = 'none';
  });
}

function initMouseTracking() {
  const tracker = document.getElementById('mouseTracker');
  const events = document.getElementById('mouseEvents');
  let eventLog = [];
  const logEvent = (type, x, y) => {
    eventLog.unshift(type + ': (' + x + ', ' + y + ')');
    if (eventLog.length > 5) eventLog.pop();
    events.innerHTML = eventLog.join('<br>');
  };
  tracker.addEventListener('mouseenter', (e) => logEvent('mouseenter', e.clientX, e.clientY));
  tracker.addEventListener('mouseleave', (e) => logEvent('mouseleave', e.clientX, e.clientY));
  tracker.addEventListener('mousemove', (e) => logEvent('mousemove', e.clientX, e.clientY));
  tracker.addEventListener('click', (e) => logEvent('click', e.clientX, e.clientY));
}

// Initialize all sections on page load
onReady(() => {
  initFileUpload();
  initIframe();
  initLazy();
  updateResolution();
  initHover();
  initMouseTracking();
  window.addEventListener('resize', updateResolution);
});
</script>
</body>
</html>
